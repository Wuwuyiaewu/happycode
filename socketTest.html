<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="./js/vue.js"></script>
  <script src="./js/axios.js"></script>
  <title>ix中間層連接</title>
</head>

<body>
  <div id="app">

  </div>

  <script src="./js/socketText.js"></script>
  <script>
    const data = JSON.stringify({ "head": { "appKey": "JW666key" }, "data": {} });
    var vm = new Vue({
      el: "#app",
      data() {
        return {
          APP_KEY: 'JW666key',
          WS_BASE_URL: 'wss://api.dragonfly8.com/websocket',
          HTTP_BASE_URL: 'https://api.dragonfly8.com',
          GET_ACCOUNT_PROPERTIES: '/account/appProperties/getAccountProperties',
          ax_config: {
            method: 'post',
            url: 'https://api.dragonfly8.com/account/appProperties/getAccountProperties',
            headers: {
              'Content-type': 'application/json',
              'module': 'uat-account',
              'rpcType': 'http',
              'method': '/account/appProperties/getAccountProperties',
              'httpMethod': 'post'
            },
            data: data
          },
          config: {
            companyid: "",
            platform: "",
          },
          account: {
            accountNo: "",
            password: "",
            accountType: "",
            clientIp: "",
            authorization: "",
            userType: ""
          },
          resData: {
          },
          ws: new WebSocket(`wss://api.dragonfly8.com/websocket`)
        }
      },
      computed: {
      },
      methods: {
        send() {
          let vm = this
          axios(vm.ax_config)
            .then(function (response) {
              vm.account.authorization = response.headers.authorization
              vm.resData = response.data
              console.log(response);

              vm.get_account_properties(vm.resData)
            })
            .catch(function (error) {
            });
        },
        get_account_properties(res) {
          console.log(res);
          let vm = this
          vm.config.companyid = res.data.transBaseConfigVo.companyId
          vm.config.platform = res.data.transBaseConfigVo.platform
          vm.account.clientIp = res.data.clientIp;
          vm.account.accountType = res.data.toKenCompanyInfoVo.accountType;
          console.log(vm.config, vm.account);
          if (res.data.toKenCompanyInfoVo.accountType == "real") {
            vm.account.accountNo = res.data.toKenCompanyInfoVo.mobilePhone;
            vm.account.userType = 0;
          } else if (res.data.toKenCompanyInfoVo.accountType == "demo") {
            vm.account.accountNo = res.data.toKenCompanyInfoVo.mobilePhone;
            vm.account.userType = 1;
          } else {
            vm.account.accountNo = "Guest";
            vm.account.userType = 1;
          }
          vm.init()
        },
        init(){
          let vm = this
          console.log("open connection");
          vm.ws.open()
          vm.login(vm.ws)
          let xd = 'xd'
          console.log(vm.xd);
          
        },
        login(){

        }
      },
      mounted() {

      },
      created() {
        this.send()
      }
    });

  </script>
</body>

</html>